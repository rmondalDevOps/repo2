pipeline {
    agent { label 'Rachita'
    }
stages {
        stage('About the job') {
            steps {
                echo "This is to copy a file from GitHub repository to the agent machine"
            }
        }
	stage('Check if Git is installed') {
            steps {
	    powershell '''
                $items= Get-ChildItem "C:\\Program Files" -recurse | Where-Object {$_.extension -eq ".exe"}
$score=0
Foreach($item in $items){
    if($item -like "*Git*"){
        $score+=1
        break
    }
   }
   if($score -ge 1)
   {
   Write-Host "Git is installed"
   }
    else{
    Write-Host "Git is not installed....Installing Git through Chocolatey"
    Set-ExecutionPolicy Bypass -Scope Process
    #installing chocolatey
    Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
    #now installing git
    choco install -y git
    } 
    '''

            }
        }
        stage('copying files') {
            steps {
                powershell '''
			Invoke-WebRequest -Uri https://github.com/rmondalDevOps/repo2/blob/f8390d6492e54b68250e2c345a8b5f30e16bfef5/install_links.sh -OutFile install_links_copy.sh
			Write-Host "Your file is copied!"
			'''
            }
        }
    }
}
